'use strict';

var types_algorandClient = require('../../types/algorand-client.js');
var types_clientManager = require('../../types/client-manager.js');
var account = require('../account.js');
var indexer = require('../indexer.js');
var transactionLogger = require('../transaction-logger.js');
var amount = require('../../amount.js');
var indexerLookup = require('../../indexer-lookup.js');
var config = require('../../config.js');

function algorandFixture(fixtureConfig, config$1) {
    fixtureConfig = { ...fixtureConfig, ...config$1 };
    if (!fixtureConfig.algod || !fixtureConfig.indexer || !fixtureConfig.kmd) {
        fixtureConfig = { ...types_clientManager.ClientManager.getConfigFromEnvironmentOrLocalNet(), ...fixtureConfig };
    }
    const algod = fixtureConfig.algod ?? types_clientManager.ClientManager.getAlgodClient(fixtureConfig.algodConfig);
    const indexer$1 = fixtureConfig.indexer ?? types_clientManager.ClientManager.getIndexerClient(fixtureConfig.indexerConfig);
    const kmd = fixtureConfig.kmd ?? types_clientManager.ClientManager.getKmdClient(fixtureConfig.kmdConfig);
    let context;
    let algorandClient;
    const beforeEach = async () => {
        config.Config.configure({ debug: true });
        const transactionLogger$1 = new transactionLogger.TransactionLogger();
        const transactionLoggerAlgod = transactionLogger$1.capture(algod);
        algorandClient = algorandClient ?? types_algorandClient.AlgorandClient.fromClients({ algod: transactionLoggerAlgod, indexer: indexer$1, kmd });
        const acc = await account.getTestAccount({ initialFunds: fixtureConfig?.testAccountFunding ?? amount.algos(10), suppressLog: true }, algorandClient);
        algorandClient.setSignerFromAccount(acc).setDefaultValidityWindow(1000).setSuggestedParamsTimeout(0);
        const testAccount = { ...acc, signer: algorandClient.account.getSigner(acc.addr) };
        context = {
            algorand: algorandClient,
            algod: transactionLoggerAlgod,
            indexer: indexer$1,
            kmd: kmd,
            testAccount,
            generateAccount: async (params) => {
                const account$1 = await account.getTestAccount(params, algorandClient);
                algorandClient.setSignerFromAccount(account$1);
                return { ...account$1, signer: algorandClient.account.getSigner(account$1.addr) };
            },
            transactionLogger: transactionLogger$1,
            waitForIndexer: () => transactionLogger$1.waitForIndexer(indexer$1),
            waitForIndexerTransaction: (transactionId) => indexer.runWhenIndexerCaughtUp(() => indexerLookup.lookupTransactionById(transactionId, indexer$1)),
        };
    };
    return {
        get context() {
            return context;
        },
        get algorand() {
            return algorandClient;
        },
        beforeEach,
    };
}

exports.algorandFixture = algorandFixture;
//# sourceMappingURL=algorand-fixture.js.map
